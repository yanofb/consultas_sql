-- Cenário: tabela com dados fictício de uma empresa de telefonia.

--CONSULTANDO OS DADOS DA TABELA
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER` LIMIT 5 

-- FILTRANDO A TABELA COM UMA CLÁUSULA DE WHERE
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
WHERE GENDER = "Male"

-- FILTRANDO A TABELA COM MAIS DE UMA CLÁUSULA DE WHERE, COM ADIÇÃO (QUERO X E Y)
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
WHERE GENDER = "Male" AND AGE >= 30

-- FILTRANDO A TABELA COM MAIS DE UMA CLÁUSULA DE WHERE, COM OPÇÃO (QUERO X OU Y)
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
WHERE GENDER = "Male" OR AGE <= 40

-- FILTRANDO A TABELA COM MAIS DE UMA CLÁUSULA DE WHERE, USANDO IN (IDEIA DE ESTAR DENTRO DO CONJUNTO)
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
WHERE GENDER = "Male" AND AGE IN (40,50,60)

-- FILTRANDO A TABELA COM MAIS DE UMA CLÁUSULA DE WHERE, USANDO LIKE (IDEIA DE PERTENCE PARCIALMENTE OU TOTALMENTE)
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
WHERE GENDER = "Male" AND City LIKE '%Los%' -- porcentagem só na frente, quer dizer:termina com. porcentagem só no fim: começa com. porcentagem início e fim: possui isso em algum lugar

-- CRIANDO TABELAS PARALELAS: EXEMPLO TABELA SÓ COM GÊNERO MASCULINO
CREATE OR REPLACE TABLE TABELA_CHURN.customers_male as
SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
WHERE GENDER = "Male"

-- CRIANDO SUBQUERIES: SEPARANDO POR MÉTODO DE PAGAMENTO
SELECT City, COUNT(DISTINCT Customer_ID) AS TOTAL_CLIENTES
FROM (
  SELECT Customer_ID, City from `TABELA_CHURN.TELECOM_CUSTOMER`
  WHERE Payment_Method = "Credit Card"
  GROUP BY City,Customer_ID)
  GROUP BY City
  ORDER BY COUNT(DISTINCT Customer_ID) DESC

  -- CRIANDO CTEs: SEPARANDO POR MÉTODO DE PAGAMENTO E GÊNERO
  WITH METODO_PAGAMENTO AS 
  (SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
  WHERE Payment_Method = "Credit Card"
  ),--CRIADA COMO UMA TABELA DE CONSULTA, COM DADOS DE METODO PAGAMENTO = CREDIT CARD

  MALE_CUSTOMER AS (
    SELECT * FROM `TABELA_CHURN.TELECOM_CUSTOMER`
  WHERE GENDER = "Male"
  ),--CRIADA A TABELA DE CONSULTA, COM DADOS DE GÊNERO = MALE

  METODO_MALE AS(
    SELECT * FROM MALE_CUSTOMER a JOIN METODO_PAGAMENTO b ON a.Customer_ID = b.Customer_ID
  ) -- SELECIONA TODA A BASE QUE CONTÉM MÉTODO CREDIT CARD E GENDER = MALE, ATRAVÉS DO JOIN DE CUSTOMER_ID ENTRE AS TABELAS CRIADAS.

  SELECT * FROM METODO_MALE

